<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tRPC-Cpp: trpc::RetryLimitClientFilter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tRPC-Cpp<span id="projectnumber">&#160;1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetrpc.html">trpc</a></li><li class="navelem"><a class="el" href="classtrpc_1_1_retry_limit_client_filter.html">RetryLimitClientFilter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">trpc::RetryLimitClientFilter Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>The rate limiting protection filter that used in conjunction with the backup request retry feature.  
 <a href="classtrpc_1_1_retry_limit_client_filter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="retry__limit__client__filter_8h_source.html">retry_limit_client_filter.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for trpc::RetryLimitClientFilter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classtrpc_1_1_retry_limit_client_filter.png" usemap="#trpc::RetryLimitClientFilter_map" alt=""/>
  <map id="trpc::RetryLimitClientFilter_map" name="trpc::RetryLimitClientFilter_map">
<area href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html" title="Client filter." alt="trpc::Filter&lt; ClientContextPtr &gt;" shape="rect" coords="0,0,183,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a5225df15a86720f9757da9337cb0a184" id="r_a5225df15a86720f9757da9337cb0a184"><td class="memItemLeft" align="right" valign="top"><a id="a5225df15a86720f9757da9337cb0a184" name="a5225df15a86720f9757da9337cb0a184"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>RetryLimitClientFilter</b> (const <a class="el" href="structtrpc_1_1_retry_hedging_limit_config.html">RetryHedgingLimitConfig</a> *config)</td></tr>
<tr class="separator:a5225df15a86720f9757da9337cb0a184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4dee298807d96b8876d94dd71786e1c" id="r_ab4dee298807d96b8876d94dd71786e1c"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_retry_limit_client_filter.html#ab4dee298807d96b8876d94dd71786e1c">Name</a> () override</td></tr>
<tr class="separator:ab4dee298807d96b8876d94dd71786e1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a680c3b35767b6bda1b45e7966cc5fae9" id="r_a680c3b35767b6bda1b45e7966cc5fae9"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="namespacetrpc.html#a30ad6719274d32670d65731183e4db12">FilterPoint</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_retry_limit_client_filter.html#a680c3b35767b6bda1b45e7966cc5fae9">GetFilterPoint</a> () override</td></tr>
<tr class="separator:a680c3b35767b6bda1b45e7966cc5fae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9eb1a5ebb5420883e0a0331a3beb6fd" id="r_ae9eb1a5ebb5420883e0a0331a3beb6fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_retry_limit_client_filter.html#ae9eb1a5ebb5420883e0a0331a3beb6fd">operator()</a> (<a class="el" href="namespacetrpc.html#ad2843836703e68d6a142b786a0876023">FilterStatus</a> &amp;status, <a class="el" href="namespacetrpc.html#a30ad6719274d32670d65731183e4db12">FilterPoint</a> point, const <a class="el" href="classtrpc_1_1_ref_ptr.html">ClientContextPtr</a> &amp;context) override</td></tr>
<tr class="separator:ae9eb1a5ebb5420883e0a0331a3beb6fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e86167c85aefba6e23f4be073f4738" id="r_a51e86167c85aefba6e23f4be073f4738"><td class="memItemLeft" align="right" valign="top">MessageClientFilterPtr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_retry_limit_client_filter.html#a51e86167c85aefba6e23f4be073f4738">Create</a> (const std::any &amp;param) override</td></tr>
<tr class="memdesc:a51e86167c85aefba6e23f4be073f4738"><td class="mdescLeft">&#160;</td><td class="mdescRight">The method is used to create filter, which can be overloaded to implement data binding between each service and its service-level filters.  <br /></td></tr>
<tr class="separator:a51e86167c85aefba6e23f4be073f4738"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html">trpc::Filter&lt; ClientContextPtr &gt;</a></td></tr>
<tr class="memitem:a4c94cc4d57e2193df3af59bd4a91dd92 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4" id="r_a4c94cc4d57e2193df3af59bd4a91dd92"><td class="memItemLeft" align="right" valign="top">
virtual <a class="el" href="namespacetrpc.html#a1acfffc3d3bd36f413b6360fad52002a">FilterType</a>&#160;</td><td class="memItemRight" valign="bottom"><b>Type</b> ()</td></tr>
<tr class="memdesc:a4c94cc4d57e2193df3af59bd4a91dd92 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="mdescLeft">&#160;</td><td class="mdescRight">type of filter <br /></td></tr>
<tr class="separator:a4c94cc4d57e2193df3af59bd4a91dd92 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6381ab948559e6386ed5f4194c76170f inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4" id="r_a6381ab948559e6386ed5f4194c76170f"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html#a6381ab948559e6386ed5f4194c76170f">Init</a> ()</td></tr>
<tr class="memdesc:a6381ab948559e6386ed5f4194c76170f inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the filter.  <br /></td></tr>
<tr class="separator:a6381ab948559e6386ed5f4194c76170f inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae192275eca45464969152b8c4ef2c941 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4" id="r_ae192275eca45464969152b8c4ef2c941"><td class="memItemLeft" align="right" valign="top">virtual uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html#ae192275eca45464969152b8c4ef2c941">GetFilterID</a> ()</td></tr>
<tr class="memdesc:ae192275eca45464969152b8c4ef2c941 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the filter ID stored in filter_id_ member variable.  <br /></td></tr>
<tr class="separator:ae192275eca45464969152b8c4ef2c941 inherit pub_methods_classtrpc_1_1_filter_3_01_client_context_ptr_01_4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The rate limiting protection filter that used in conjunction with the backup request retry feature. </p>
<p>It is used to disable retries when the request failure rate is too high, in order to avoid overloading the backend service. The algorithm is implemented using a token bucket mechanism:</p><ol type="1">
<li>The number of tokens in the bucket is initialized to max_tokens. When a request succeeds, the token count is increased by 1 until it reaches max_tokens.</li>
<li>When a request fails, the token count is decreased by N (i.e. token_ratio) until it is less than 0.</li>
<li>The retry/hedging strategy only works normally when the number of tokens in the bucket is greater than half of the capacity. When the number of tokens is less than or equal to half of the capacity, retries are cancelled. <dl class="section note"><dt>Note</dt><dd>If either the original request or the retry request succeeds, it is considered a success. If both fail, it is considered a failure. </dd></dl>
</li>
</ol>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a51e86167c85aefba6e23f4be073f4738" name="a51e86167c85aefba6e23f4be073f4738"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51e86167c85aefba6e23f4be073f4738">&#9670;&#160;</a></span>Create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageClientFilterPtr trpc::RetryLimitClientFilter::Create </td>
          <td>(</td>
          <td class="paramtype">const std::any &amp;&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The method is used to create filter, which can be overloaded to implement data binding between each service and its service-level filters. </p>
<p>That means each service has its own independent service filter, and does not share this filter object with other services. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param</td><td>The parameters used for create filter </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html#a5c2b8aaa43afdeeae8ab5e02f963d0da">trpc::Filter&lt; ClientContextPtr &gt;</a>.</p>

</div>
</div>
<a id="a680c3b35767b6bda1b45e7966cc5fae9" name="a680c3b35767b6bda1b45e7966cc5fae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a680c3b35767b6bda1b45e7966cc5fae9">&#9670;&#160;</a></span>GetFilterPoint()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="namespacetrpc.html#a30ad6719274d32670d65731183e4db12">FilterPoint</a> &gt; trpc::RetryLimitClientFilter::GetFilterPoint </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html">trpc::Filter&lt; ClientContextPtr &gt;</a>.</p>

</div>
</div>
<a id="ab4dee298807d96b8876d94dd71786e1c" name="ab4dee298807d96b8876d94dd71786e1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4dee298807d96b8876d94dd71786e1c">&#9670;&#160;</a></span>Name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string trpc::RetryLimitClientFilter::Name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html">trpc::Filter&lt; ClientContextPtr &gt;</a>.</p>

</div>
</div>
<a id="ae9eb1a5ebb5420883e0a0331a3beb6fd" name="ae9eb1a5ebb5420883e0a0331a3beb6fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9eb1a5ebb5420883e0a0331a3beb6fd">&#9670;&#160;</a></span>operator()()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void trpc::RetryLimitClientFilter::operator() </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetrpc.html#ad2843836703e68d6a142b786a0876023">FilterStatus</a> &amp;&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacetrpc.html#a30ad6719274d32670d65731183e4db12">FilterPoint</a>&#160;</td>
          <td class="paramname"><em>point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classtrpc_1_1_ref_ptr.html">ClientContextPtr</a> &amp;&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classtrpc_1_1_filter_3_01_client_context_ptr_01_4.html">trpc::Filter&lt; ClientContextPtr &gt;</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>trpc/filter/retry/<a class="el" href="retry__limit__client__filter_8h_source.html">retry_limit_client_filter.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 10 2023 16:03:03 for tRPC-Cpp by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
